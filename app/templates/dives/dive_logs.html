{% extends 'base.html' %}

{% block title %}My Dive Logs - Dive.site{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
<style>
    .content-container {
        margin-top: 30px;
        margin-bottom: 50px;
    }

    .page-title {
        font-size: 32px;
        font-weight: bold;
        margin-bottom: 10px;
        color: var(--primary-color);
    }

    .breadcrumb {
        background: transparent;
        padding: 0;
        margin-bottom: 30px;
    }

    .breadcrumb-item a {
        color: var(--accent-color);
    }

    .breadcrumb-item.active {
        color: var(--light-text);
    }

    .title-wavy {
        position: relative;
        padding-bottom: 15px;
    }

    .title-wavy::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: 0;
        width: 80px;
        height: 3px;
        background-color: var(--accent-color);
        border-radius: 3px;
    }

    .content-section {
        background: white;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .section-title {
        font-size: 24px;
        margin-bottom: 20px;
        color: var(--primary-color);
    }

    .chart-container {
        margin-bottom: 30px;
    }

    .chart-title {
        font-size: 18px;
        margin-bottom: 15px;
        color: var(--text-color);
    }

    .loading {
        text-align: center;
        padding: 40px 0;
    }

    .loading i {
        font-size: 32px;
        color: var(--accent-color);
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .error-message {
        text-align: center;
        padding: 20px;
        color: #e74c3c;
        background-color: #fde8e7;
        border-radius: 4px;
    }

    .error-message i {
        font-size: 24px;
        margin-bottom: 10px;
    }

    .table th {
        color: var(--light-text);
        font-weight: 500;
        border-bottom-width: 1px;
    }

    .action-btn {
        color: var(--light-text);
        background: none;
        border: none;
        padding: 5px;
        margin-right: 5px;
        cursor: pointer;
    }

    .action-btn:hover {
        color: var(--accent-color);
    }

    .action-btn.delete-btn:hover {
        color: #e74c3c;
    }

    .pagination .page-link {
        color: var(--primary-color);
        border-color: #eee;
    }

    .pagination .page-item.active .page-link {
        background-color: var(--accent-color);
        border-color: var(--accent-color);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<!-- Main content -->
<div class="container content-container">
    <!-- Breadcrumb navigation -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
            <li class="breadcrumb-item active">My Dive Logs</li>
        </ol>
    </nav>

    <!-- Page title -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="page-title title-wavy">My Dive Logs</h1>
        <button class="btn btn-primary" id="newDiveLogBtn">
            <i class="fas fa-plus-circle"></i> New Dive Log
        </button>
    </div>

    <!-- Main content area - left right split -->
    <div class="row">
        <!-- Left side - statistics charts -->
        <div class="col-md-6">
            <div class="content-section">
                <h2 class="section-title">Dive Statistics</h2>

                <!-- Dive depths chart -->
                <div class="chart-container">
                    <h3 class="chart-title">Dive Depths Over Time</h3>
                    <canvas id="depthChart"></canvas>
                </div>

                <!-- Dive frequency chart -->
                <div class="chart-container">
                    <h3 class="chart-title">Dive Frequency by Month (2025)</h3>
                    <canvas id="frequencyChart"></canvas>
                </div>

                <!-- Dive locations chart -->
                <div class="chart-container">
                    <h3 class="chart-title">Dive Locations Distribution</h3>
                    <canvas id="locationChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Right side - dive log management -->
        <div class="col-md-6">
            <div class="content-section">
                <h2 class="section-title">Dive Log Records</h2>

                <!-- Search and filter toolbar -->
                <div class="row mb-3">
                    <div class="col-md-8">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Search by location, date..." id="searchInput">
                            <button class="btn btn-outline-primary" type="button" id="searchBtn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="sortSelect">
                            <option value="date_desc">Date (Newest)</option>
                            <option value="date_asc">Date (Oldest)</option>
                            <option value="depth_desc">Depth (Deepest)</option>
                            <option value="location">Location (A-Z)</option>
                        </select>
                    </div>
                </div>

                <!-- Loading indicator -->
                <div class="loading" id="loadingIndicator">
                    <i class="fas fa-sync-alt fa-spin"></i>
                    <p>Loading dive logs...</p>
                </div>

                <!-- Dive logs table -->
                <div class="table-responsive">
                    <table class="table" id="diveLogsTable">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Date</th>
                            <th>Location</th>
                            <th>Max Depth</th>
                            <th>Duration</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- Table content will be dynamically loaded via JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- No data message -->
                <div class="text-center d-none" id="noDataMessage">
                    <p class="text-muted mt-3">No dive logs found. Add your first dive log!</p>
                </div>

                <!-- Pagination controls -->
                <nav aria-label="Dive logs pagination" class="mt-3">
                    <ul class="pagination justify-content-center" id="pagination">
                        <!-- Pagination links will be dynamically loaded via JavaScript -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- Add Dive Log Modal -->
<div class="modal fade" id="addDiveModal" tabindex="-1" aria-labelledby="addDiveModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addDiveModalLabel">Add New Dive Log</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addDiveForm">
                    <div class="row">
                        <!-- Left column -->
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="diveNumber" class="form-label">Dive Number</label>
                                <input type="number" class="form-control" id="diveNumber" required>
                            </div>
                            <div class="mb-3">
                                <label for="startTime" class="form-label">Start Time</label>
                                <input type="datetime-local" class="form-control" id="startTime" required>
                            </div>
                            <div class="mb-3">
                                <label for="endTime" class="form-label">End Time</label>
                                <input type="datetime-local" class="form-control" id="endTime" required>
                            </div>
                            <div class="mb-3">
                                <label for="maxDepth" class="form-label">Max Depth (meters)</label>
                                <input type="number" step="0.1" class="form-control" id="maxDepth" required>
                            </div>
                            <div class="mb-3">
                                <label for="weightBelt" class="form-label">Weight Belt</label>
                                <input type="text" class="form-control" id="weightBelt">
                            </div>
                            <div class="mb-3">
                                <label for="suitType" class="form-label">Suit Type</label>
                                <select class="form-control" id="suitType">
                                    <option value="">Select Suit Type</option>
                                    <option value="None">None</option>
                                    <option value="Shorty">Shorty</option>
                                    <option value="Wetsuit">Wetsuit</option>
                                    <option value="Semi-Dry">Semi-Dry</option>
                                    <option value="Drysuit">Drysuit</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="suitThickness" class="form-label">Suit Thickness (mm)</label>
                                <input type="number" step="0.1" min="0" max="10" class="form-control" id="suitThickness">
                            </div>
                            <div class="mb-3">
                                <label for="weight" class="form-label">Weight (kg)</label>
                                <input type="number" step="0.1" min="0" max="20" class="form-control" id="weight">
                            </div>
                        </div>

                        <!-- Right column -->
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="visibility" class="form-label">Visibility</label>
                                <input type="text" class="form-control" id="visibility">
                            </div>
                            <div class="mb-3">
                                <label for="weather" class="form-label">Weather Conditions</label>
                                <input type="text" class="form-control" id="weather">
                            </div>
                            <div class="mb-3">
                                <label for="location" class="form-label">Location</label>
                                <input type="text" class="form-control" id="location" required>
                            </div>
                            <div class="mb-3">
                                <label for="divePartner" class="form-label">Dive Partner</label>
                                <input type="text" class="form-control" id="divePartner">
                            </div>
                            <div class="mb-3">
                                <label for="media" class="form-label">Media URL</label>
                                <input type="text" class="form-control" id="media">
                            </div>
                            <div class="mb-3">
                                <label for="tankType" class="form-label">Tank Type</label>
                                <select class="form-control" id="tankType">
                                    <option value="">Select Tank Type</option>
                                    <option value="Aluminum">Aluminum</option>
                                    <option value="Steel">Steel</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="tankSize" class="form-label">Tank Size (liters)</label>
                                <input type="number" step="0.1" min="0" max="20" class="form-control" id="tankSize">
                            </div>
                            <div class="mb-3">
                                <label for="gasMix" class="form-label">Gas Mix</label>
                                <select class="form-control" id="gasMix">
                                    <option value="">Select Gas Mix</option>
                                    <option value="Air">Air</option>
                                    <option value="Nitrox">Nitrox</option>
                                    <option value="Trimix">Trimix</option>
                                    <option value="Heliox">Heliox</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="o2Percentage" class="form-label">O2 Percentage (%)</label>
                                <input type="number" step="0.1" min="21" max="100" class="form-control" id="o2Percentage">
                            </div>
                        </div>

                        <!-- Full width notes -->
                        <div class="col-12">
                            <div class="mb-3">
                                <label for="notes" class="form-label">Notes</label>
                                <textarea class="form-control" id="notes" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveDiveBtn">Save Dive Log</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/dives.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 模拟图表数据
        initCharts();
        
        // 添加新潜水记录按钮事件
        document.getElementById('newDiveLogBtn').addEventListener('click', function() {
            var modal = new bootstrap.Modal(document.getElementById('addDiveModal'));
            modal.show();
        });
        
        // 隐藏加载指示器（模拟加载完成）
        setTimeout(function() {
            document.getElementById('loadingIndicator').style.display = 'none';
        }, 1000);
    });
    
    // 初始化图表
    function initCharts() {
        // 深度图表
        const depthCtx = document.getElementById('depthChart').getContext('2d');
        new Chart(depthCtx, {
            type: 'line',
            data: {
                labels: ['Jan 5', 'Jan 12', 'Feb 3', 'Feb 20', 'Mar 15', 'Apr 2'],
                datasets: [{
                    label: 'Max Depth (m)',
                    data: [15, 18, 12, 22, 16, 19],
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        reverse: true,
                        title: {
                            display: true,
                            text: 'Depth (meters)'
                        }
                    }
                }
            }
        });
        
        // 频率图表
        const freqCtx = document.getElementById('frequencyChart').getContext('2d');
        new Chart(freqCtx, {
            type: 'bar',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Number of Dives',
                    data: [2, 2, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0],
                    backgroundColor: 'rgba(52, 152, 219, 0.7)',
                    borderColor: '#3498db',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Dives'
                        }
                    }
                }
            }
        });
        
        // 位置分布图表
        const locationCtx = document.getElementById('locationChart').getContext('2d');
        new Chart(locationCtx, {
            type: 'doughnut',
            data: {
                labels: ['Great Barrier Reef', 'Coral Bay', 'Ningaloo Reef'],
                datasets: [{
                    data: [3, 2, 1],
                    backgroundColor: [
                        '#3498db', '#2ecc71', '#f39c12'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true
            }
        });
    }
</script>
{% endblock %} 